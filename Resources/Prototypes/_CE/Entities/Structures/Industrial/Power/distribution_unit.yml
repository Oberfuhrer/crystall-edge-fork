- type: entity
  abstract: true
  parent: [ BaseMachine, ConstructibleMachine ]
  id: CEDistributionUnitBase
  categories: [ ForkFiltered ]
  name: power distribution unit
  placement:
    mode: SnapgridCenter
  components:
  - type: PlacementReplacement
    key: walls
  #- type: AmbientSound
  #  volume: -7
  #  range: 3
  #  sound:
  #    path: /Audio/Ambience/Objects/periodic_beep.ogg
  - type: Sprite
    sprite: _CE/Structures/Industrial/Power/distribution_unit.rsi
    snapCardinals: true
    drawdepth: Mobs
    layers:
      - state: base
      - state: fill-1
        shader: unshaded
        map: ["enum.SmesVisualLayers.Charge"]
        visible: false
      - state: glass
      - state: top
      - map: ["enum.SmesVisualLayers.Input"]
        state: charging0
        shader: unshaded
      - map: ["enum.SmesVisualLayers.Output"]
        state: discharging1
        shader: unshaded
  #- type: Smes #TODO: fix visuals
  #  chargeOverlayPrefix: fill-
  #  inputOverlayPrefix: charging
  #  outputOverlayPrefix: discharging
  #  numChargeLevels: 1
  - type: Appearance
  - type: Battery
    # Very important:
    # Disable networking to prevent the battery getting continuously dirtied every tick as it interacts with the power network.
    # This can not be done by changing the charge rate as the power supply ramps up over time.
    # This disables prediction for this battery.
    netsync: false
    maxCharge: 250
    startingCharge: 0
  - type: ExaminableBattery #TODO Change to mana specific
  - type: NodeContainer
    examinable: true
    nodes:
      input:
        !type:CableDeviceNode
        nodeGroupID: HVPower
      output:
        !type:CableDeviceNode
        nodeGroupID: Apc
  - type: BatteryCharger
    voltage: High
    node: input
  - type: PowerProvider
    voltage: Apc
  - type: Apc
    voltage: Apc
  - type: PointLight
    radius: 2.5
    energy: 2
    color: "#2d8ad6"
    castShadows: false
  - type: PowerNetworkBattery
    maxSupply: 5
    maxChargeRate: 5
    supplyRampTolerance: 5
    supplyRampRate: 1
  - type: Damageable
    damageContainer: StructuralInorganic
    damageModifierSet: StructuralMetallicStrong
  - type: UserInterface
    interfaces:
      enum.ApcUiKey.Key:
        type: ApcBoundUserInterface
  #- type: Destructible
  #  thresholds:
  #  - trigger:
  #      !type:DamageTrigger
  #      damage: 200
  #    behaviors:
  #    - !type:DoActsBehavior
  #      acts: [ "Destruction" ]
  #  - trigger:
  #      !type:DamageTrigger
  #      damage: 100
  #    behaviors:
  #    - !type:DoActsBehavior
  #      acts: ["Destruction"]
  #    - !type:PlaySoundBehavior
  #      sound:
  #        collection: MetalGlassBreak
  #    - !type:ExplodeBehavior
  - type: StaticPrice
    price: 100

- type: entity
  parent: CEDistributionUnitBase
  id: CEDistributionUnitBasic
  suffix: Charged
  components:
  - type: Battery
    maxCharge: 250
    startingCharge: 250

- type: entity
  parent: CEDistributionUnitBase
  id: CEDistributionUnitEmpty
  suffix: Empty
  components:
  - type: Battery
    startingCharge: 0
